<html>
    <style>
        .header1{
            margin-top: 100px;
            text-align:center;
            padding-left: 100px;
            padding: top 100px;
            font-size: 50pt;
            font-family: Georgia, 'Times New Roman', Times, serif;
        }
        .field{
            text-align:center;
            padding-left: 100px;
            padding-right: 50px;
            padding-top: 50px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 20pt;
        }
        .instructions{
            text-align:left;
            padding-left: 100px;
            padding-right: 50px;
            padding-top: 50px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 20pt;
            color: black;
        }
        .bottondownload{
            font-size: 23pt;
            text-align: center;
            color: black;
            background-color: rgb(248, 0, 136);
            padding-top: 10px;
            padding-bottom: 10px;
            padding-left: 10px;
            padding-right: 10px;
            margin-left: 100px;
            margin-right: 100px;
            border: 3px outset black;
        }
        .text_color{
            color: black;
            text-decoration: none;
        }
        a:link{
            text-decoration: none;
        }
        a:visited{
            text-decoration: none;
        }
        a:hover{
            text-decoration: none;
            background-color: black;
            color: rgb(248, 0, 136);
            border: 3px outset rgb(248, 0, 136);
        }
        a:active{
            text-decoration: none;
        }
        .checkbox{
            font-size: 20pt;
        }
    </style>
    <title>
        Tagging Entities
    </title>
    <body>
        <div class = "header1"> <b>Entity Extractor</b></div>
        <div class = "instructions"><p id="instruc"> To create the training file for the TFM_NER you have to input the text in the box below with the class/type next to it. After that you must high light the text associated with it. </p></div><br>
        <div class = "field">
            <form id="Tag_entities" onsubmit="onformsubmit();">
                <textarea name="Input Sentence" id="Input Sentence" cols="90" rows="30"></textarea><br><p></p>
                <p></p>
                <select name="tagging_method" id="tagging_method"><option value="Variable Name and Type">Variable Name and Type</option><option value="Tagging Using Buttons">Tagging Using Buttons</option><option value="Tagging With drop down Menu">Tagging With drop down Menu</option><option value="Tagging with pop up menu">Tagging with pop up menu</option><option value="generate tags with buttons">generate tags with buttons</option><option value="generate tags with lists">generate tags with lists</option></select><button id="Create_button">Add Tag</button><input type="text" id="button_name"><input type="text" id="Remove_button"><button id="remove_btn">Remove Tag</button><p></p>
                <select name="Tag" id="Tag_type"><option value="Add a tag">Add a Tag</option></select><br>
            </form>
            <form id="Get_Tags" onsubmit="onformsubmit();">
                <textarea name="Output Sentence" id="output" cols="90" rows="30"></textarea><br><p></p><input type="Submit" name="Submit" id="submit_tag"><p></p><p></p>
                <div class = "bottondownload"><b><a href="tfm_ner_data.json"><div class="text_color">Download</div></a></b></div>
            </form>
        </div>
    </body>
    <script>
        let tagging_type = " ";
        let method = document.getElementById("tagging_method").value;
        document.getElementById("tagging_method").addEventListener("change", chosen_method);
        function chosen_method(){
            method = document.getElementById("tagging_method").value;
            console.log(method);
            if(method === "Variable Name and Type"){
                console.log("The instructions are the same");
            }
            if(method === "Tagging Using Buttons"){
                document.getElementById("instruc").innerHTML = "To tag the text for the TFM_Ner, you must first add tags by using the add tag button below. Next you tap the tag created then highlight the text to be tagged then press Alt on your keyboard. You can change tagging type using the drop down menu near the add tag button.";
            }
            if(method === "Tagging With drop down Menu"){
                document.getElementById("instruc").innerHTML = "To tag the text, first use the add tag box to create tag types for the dropdown menu. Then chang the drop down menu to the tage you want, then you highlight the text and press Alt on your keyboard.";
            }
            if(method === "Tagging with pop up menu"){
                document.getElementById("instruc").innerHTML = "To tag the text for the tfm_ner first you hight the text you want to tag, then you press Alt on your key board. A pop up menu will appear. You then have to enter the tag type/name there and press ok.";
            }
        }
        function set_value(){
            console.log("We change so the tagging type changed");
            if(method === "Tagging Using Buttons"){
                tagging_type = document.activeElement.innerHTML;
                console.log(tagging_type);
            }
            if(method === "Tagging With drop down Menu"){
                tagging_type = document.getElementById("Tag_type").value;
                console.log(tagging_type);
            }
            
        }
        function onformsubmit(){
            event.preventDefault();
        }
        document.getElementById("Create_button").addEventListener("click", create_new_tag);
        let name_tag = "";
        function create_new_tag(){
            name_tag = document.getElementById("button_name").value;
            generate_tag();
        }
        function generate_tag(){
            if(method == "Tagging Using Buttons"){
                console.log(name_tag);
                let btn = document.createElement("button");
                btn.innerHTML = name_tag;
                btn.id = btn.innerHTML;
                document.getElementById("Tag_entities").appendChild(btn);
                document.getElementById(btn.innerHTML).addEventListener("click", set_value);
            }
            if(method == "Tagging With drop down Menu"){
                console.log(name_tag);
                let option = document.createElement("option");
                option.innerHTML = name_tag;
                option.id = option.innerHTML;
                document.getElementById("Tag_type").appendChild(option);
                document.getElementById("Tag_type").addEventListener("change", set_value);
            }
            
        }
        document.getElementById("remove_btn").addEventListener("click",remove_the_button);
        function remove_the_button(){
            name_btn = document.getElementById("Remove_button").value;
            removing_button = document.getElementById(name_btn).remove();
        }
        function gethighlightedtext(){
            var text = "";
            document.getSelection.toString();
            if(window.getSelection){
                text = window.getSelection().toString();
            }else if (document.selection && document.selection.type != "Control"){
                text = document.selection.createRange().text;
            }
            return text;
        }
        
        function format_text(){
            var text_f = gethighlightedtext();
            new_text = "["+text_f+")"; 
            find_text = new_text.lastIndexOf(" ");
            text_index = find_text+1;
            var final_text = new_text.slice(0,find_text) +"]"+" "+"("+new_text.slice(text_index);
            entire_text = document.getElementById("Input Sentence").value;
            start_index = entire_text.search(text_f); 
            last_index = start_index + text_f.length;
            var new_string = entire_text.slice(0,start_index) +final_text+ entire_text.slice(last_index);
            document.getElementById("Input Sentence").value = new_string;
            return new_string;
        }

        function tag_text(){
            var text_g = gethighlightedtext();
            new_text = "["+text_g+"]"+" "+"("+tagging_type+")"; 
            entire_text = document.getElementById("Input Sentence").value;
            start_index = entire_text.search(text_g); 
            last_index = start_index + text_g.length;
            var new_string = entire_text.slice(0,start_index) +new_text+ entire_text.slice(last_index);
            document.getElementById("Input Sentence").value = new_string;
            return new_string;
        }

        function tag_menu(){
            var text_h = gethighlightedtext();
            new_text = "["+text_h+"]"+" "+"("+tagging_type+")"; 
            entire_text = document.getElementById("Input Sentence").value;
            start_index = entire_text.search(text_h); 
            last_index = start_index + text_h.length;
            var new_string = entire_text.slice(0,start_index) +new_text+ entire_text.slice(last_index);
            document.getElementById("Input Sentence").value = new_string;
            return new_string;
        }

        function prompt_tag(){
            var text_i = gethighlightedtext();
            tagging_type = prompt("Enter the Tag Type");
            new_text = "["+text_i+"]"+" "+"("+tagging_type+")"; 
            entire_text = document.getElementById("Input Sentence").value;
            start_index = entire_text.search(text_i); 
            last_index = start_index + text_i.length;
            var new_string = entire_text.slice(0,start_index) +new_text+ entire_text.slice(last_index);
            document.getElementById("Input Sentence").value = new_string;
            return new_string;
        }

        function start_tagging(){
            if(event.keyCode === 18){
                if(method === "Variable Name and Type"){
                    format_text();
                }
                if(method === "Tagging Using Buttons"){
                    tag_text();
                }
                if(method === "Tagging With drop down Menu"){
                    tag_menu();
                }
                if(method === "Tagging with pop up menu"){
                    prompt_tag();
                }
                if(method === "generate tags with buttons"){
                    entire_text = document.getElementById("Input Sentence").value+" ";
                    while(entire_text.search(" ") >= 0){
                        text_checking = entire_text.slice(0, 1);
                        entire_text = entire_text;
                        entire_text = entire_text.slice(1);
                        console.log(entire_text);
                        console.log(text_checking);
                        if(text_checking == "("){
                            found_txt = entire_text.search(" ");
                            console.log(found_txt);
                            tag_typ = entire_text.slice(0,found_txt-1);
                            console.log(tag_typ);
                            name_tag = tag_typ;
                            console.log(name_tag);
                            let btn = document.createElement("button");
                            btn.innerHTML = name_tag;
                            btn.id = btn.innerHTML;
                            document.getElementById("Tag_entities").appendChild(btn);
                            document.getElementById(btn.innerHTML).addEventListener("click", set_value);
                        }
                    }
                }
                if(method === "generate tags with lists"){
                    entire_text = document.getElementById("Input Sentence").value+" ";
                    while(entire_text.search(" ") >= 0){
                        text_checking = entire_text.slice(0, 1);
                        entire_text = entire_text;
                        entire_text = entire_text.slice(1);
                        console.log(entire_text);
                        console.log(text_checking);
                        if(text_checking == "("){
                            found_txt = entire_text.search(" ");
                            console.log(found_txt);
                            tag_typ = entire_text.slice(0,found_txt-1);
                            console.log(tag_typ);
                            name_tag = tag_typ;
                            console.log(name_tag);
                            let option = document.createElement("option");
                            option.innerHTML = name_tag;
                            option.id = option.innerHTML;
                            document.getElementById("Tag_type").appendChild(option);
                            document.getElementById("Tag_type").addEventListener("change", set_value);
                        }
                    }
                }
            }
        }
        document.onkeyup = start_tagging;
    </script>
</html>